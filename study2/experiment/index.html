<!DOCTYPE html>
<html>
    <head>
        <!-- Title shown in tab -->
        <title>University of Sussex - Research</title>

        <!-- Load all necessary plugins -->
        <script src="https://unpkg.com/jspsych@8.0.2"></script>
        <script src="https://unpkg.com/@jspsych/plugin-browser-check@1.0.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey@2.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script>
        <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>

        <!-- Plots -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://realitybending.github.io/JSmisc/misc/plots.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-canvas-button-response@2.0.0"></script>

        <!-- Load parameters here (always below the loading of the JsPsych) -->
        <!-- <script src="intero.js"></script> -->
        <script src="demographics.js"></script>
        <script src="questionnaires_mint.js"></script>
        <script src="questionnaires_interoception.js"></script>
        <script src="questionnaires_convergent.js"></script>
        <script src="questionnaires_pathology.js"></script>
        <script src="postprocessing.js"></script>

        <link
            href="https://unpkg.com/jspsych@8.0.1/css/jspsych.css"
            rel="stylesheet"
            type="text/css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/@jspsych/plugin-survey@2.0.0/css/survey.css"
        />
    </head>

    <body></body>

    <script>
        // Initialize experiment =================================================
        var timeline = []

        var jsPsych = initJsPsych({
            show_progress_bar: true,
            on_finish: function () {
                jsPsych.data.displayData("json") // Display data in browser
                // window.location = "https://realitybending.github.io/research/#participate" // Redirect to lab website

                // If prolific and passed the attention check, redirect to prolific completion link
                // if (jsPsych.data.urlVariables()["exp"] == "prolific") {
                //     d = jsPsych.data
                //         .get()
                //         .filter({ screen: "demographics_debrief" })["trials"][0]
                //     if (d["Reward"] == "Automatic") {
                //         window.location =
                //             "https://app.prolific.com/submissions/complete?cc=C8I1NGST"
                //     } else {
                //         window.location =
                //             "https://app.prolific.com/submissions/complete?cc=C1BHVQIZ"
                //     }
                // }
            },
        })

        // Participant ID
        const participantID = jsPsych.randomization.randomID(10)

        // full screen
        timeline.push(ConsentForm)

        // Shuffle -----------------------------------------------------------------
        qs_intero = jsPsych.randomization.shuffleNoRepeats([
            questionnaire_maia,
            questionnaire_ias,
            questionnaire_bpq,
        ])
        qs_convergent = jsPsych.randomization.shuffleNoRepeats([
            questionnaire_tas,
            // questionnaire_erq,
            questionnaire_pi18,
            questionnaire_cerq,
            questionnaire_ers,
        ])
        qs_pathology = jsPsych.randomization.shuffleNoRepeats([
            questionnaire_cefsa,
            questionnaire_phq15,
            questions_mentalhealth,
            questionnaire_phq4,
        ])

        // Start -------------------------------------------------------------------
        timeline.push(demographics_browser_info)
        // timeline.push(demographic_questions)
        // timeline.push(questionnaires_instructions)
        // timeline.push(questionnaire_mint)

        timeline.push(questionnaire_maia)

        // shuffle intero questionnaires
        // timeline.push(qs_intero[0])
        // timeline.push(qs_intero[1])
        // timeline.push(qs_intero[2])
        // // shuffle convergent questionnaires
        // timeline.push(qs_convergent[0])
        // timeline.push(qs_convergent[1])
        // timeline.push(qs_convergent[2])
        // timeline.push(qs_convergent[3])
        // timeline.push(qs_convergent[4])
        // // shuffle pathology questionnaires
        // timeline.push(qs_pathology[0])
        // timeline.push(qs_pathology[1])
        // timeline.push(qs_pathology[2])
        // timeline.push(qs_pathology[3])

        // timeline.push(demographics_wearables)
        // timeline.push(radar_feedback)
        // timeline.push(experiment_feedback)
        // timeline.push(demographics_debriefing)

        // save data via DataPipe
        // timeline.push({
        //     type: jsPsychPipe,
        //     action: "save",
        //     experiment_id: "818NyQh9EBvw", // This in generated in the DataPipe interface
        //     filename: `${participantID}.csv`,
        //     data_string: () => jsPsych.data.get().csv(),
        // })

        timeline.push(demographics_endscreen)
        /* ----------------- Run the timeline ----------------- */
        jsPsych.run(timeline)
    </script>
</html>
